# ruff: noqa: E501
# Auto-generated by scripts/gen_url_testcase.py

from dataclasses import dataclass

import pytest

from novelkit.infra.url_resolver import resolve_book_url


@dataclass(frozen=True)
class SuccessCase:
    url: str
    site_key: str
    book_id: str | None
    chap_id: str | None = None


# fmt: off
CASES_SUCCESS = [
    SuccessCase("http://www.aaatxt.com/shu/24514.html", "aaatxt", "24514", None),
    SuccessCase("http://www.aaatxt.com/yuedu/24514_1.html", "aaatxt", "24514", "1"),
    SuccessCase("https://www.akatsuki-novels.com/stories/index/novel_id~103", "akatsuki_novels", "103", None),
    SuccessCase("https://www.akatsuki-novels.com/stories/view/163722/novel_id~103", "akatsuki_novels", "103", "163722"),
    SuccessCase("https://www.akatsuki-novels.com/stories/index/novel_id~24039", "akatsuki_novels", "24039", None),
    SuccessCase("https://www.akatsuki-novels.com/stories/index/novel_id~24039/page~2", "akatsuki_novels", "24039", None),
    SuccessCase("https://www.akatsuki-novels.com/stories/index/page~3/novel_id~24039", "akatsuki_novels", "24039", None),
    SuccessCase("https://www.akatsuki-novels.com/stories/index/novel_id~14222#bottom", "akatsuki_novels", "14222", None),
    SuccessCase("https://www.akatsuki-novels.com/stories/view/138014/novel_id~14222#bottom", "akatsuki_novels", "14222", "138014"),
    SuccessCase("https://www.alicesw.com/novel/35573.html", "alicesw", "35573", None),
    SuccessCase("https://www.alicesw.com/other/chapters/id/35573.html", "alicesw", "35573", None),
    SuccessCase("https://www.alicesw.com/book/37978/0efc1aa0b9555.html", "alicesw", None, "37978-0efc1aa0b9555"),
    SuccessCase("https://www.alicesw.tw/novel/47396.html", "alicesw", "47396", None),
    SuccessCase("https://www.alicesw.tw/other/chapters/id/47396.html", "alicesw", "47396", None),
    SuccessCase("https://www.alicesw.tw/book/48755/93316df62351f.html", "alicesw", None, "48755-93316df62351f"),
    SuccessCase("https://www.alphapolis.co.jp/novel/547686423/112003230", "alphapolis", "547686423-112003230", None),
    SuccessCase("https://www.alphapolis.co.jp/novel/547686423/112003230/episode/10322710", "alphapolis", "547686423-112003230", "10322710"),
]

CASES_NONE = [
    "http://www.aaatxt.com/",
    "https://www.akatsuki-novels.com/",
    "https://www.alicesw.com/",
    "https://www.alicesw.tw/",
    "https://www.alphapolis.co.jp/",
]

CASES_INVALID = [
    # URLs with no rule should return None
    "https://www.unknownsite.com/book/123.html",
    "https://example.org/unrelated/page",
    "not a url",
    "",
]
# fmt: on


@pytest.mark.parametrize("case", CASES_SUCCESS)
def test_resolver_extracts_expected_ids(case: SuccessCase):
    result = resolve_book_url(case.url)
    assert result is not None, f"{case.url}: expected BookURLInfo, got None"
    assert result["site_key"] == case.site_key
    assert result["book_id"] == case.book_id
    assert result["chapter_id"] == case.chap_id, (
        f"{case.url}: expected chapter_id={case.chap_id}, got {result['chapter_id']}"
    )


@pytest.mark.parametrize("url", CASES_NONE)
def test_resolver_returns_none_for_unmatched_paths(url):
    assert resolve_book_url(url) is None


@pytest.mark.parametrize("url", CASES_INVALID)
def test_resolver_handles_invalid_urls(url: str):
    result = resolve_book_url(url)
    assert result is None, f"{url}: expected None for invalid URL"
